---
title: "TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã«å‘½ã‚’å¹ãè¾¼ã‚€: Typia ã¨ unplugin-typia"
date: '2024-06-12'
isPublished: true
lang: 'ja'
---

> [!NOTE]
> 2025å¹´6æœˆ14æ—¥è¿½è¨˜:
> [`unplugin-typia`](https://github.com/ryoppippi/unplugin-typia)ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã—ãŸã€‚
> è©³ç´°ã«é–¢ã—ã¦ã¯[`README.md`](https://github.com/ryoppippi/unplugin-typia/blob/c7cbc58cb3cceaeb0117ae3dc4ee2e7cd866ff76/README.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

# TL;DR

- ã“ã®åº¦ã€`unplugin-typia` ã¨ã„ã† Library ã‚’ä½œã‚Šã¾ã—ãŸ
- `unplugin-typia` ã‚’ä½¿ã†ã¨ä»Šã¾ã§ã‚ã‚“ã©ãã•ã‹ã£ãŸ `Typia` ã®å°å…¥ãŒç°¡å˜ã«ãªã‚Šã¾ã™
- [`Vite`](https://vitejs.dev/)ã€[`esbuild`](https://esbuild.github.io/)ã€[`webpack`](https://webpack.js.org/)ãªã©ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä¸»æµã®æ§˜ã€…ãªbundlerã«å¯¾å¿œã—ã¦ã„ã¾ã™
- [`Next.js`](https://nextjs.org/)ã§ã‚‚ç°¡å˜ã«ä½¿ãˆã¾ã™
- [`Bun`](https://bun.sh/docs/bundler)ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™

https://github.com/ryoppippi/unplugin-typia/
https://jsr.io/@ryoppippi/unplugin-typia
https://typia.io/docs/setup/#unplugin-typia

# ã¯ã˜ã‚ã«

çš†ã•ã‚“ã¯TypeScriptã§ã®Validationã«ã¯ã©ã®ã‚ˆã†ãª Library ã‚’ä½¿ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ

[`zod`](https://zod.dev/)ã¯ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒç¡¬ã„ã—ã€æœ€è¿‘ã ã¨[`valibot`](https://valibot.dev/)ãŒæµè¡Œã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã­ã€‚
ã¾ãŸ[`arktype`](https://arktype.io/)ã‚‚æ³¨ç›®ã«å€¤ã™ã‚‹Libraryã§ã™ã€‚
[`typebox`](https://github.com/sinclairzx81/typebox)ã‚‚è€³ã«ã™ã‚‹æ©Ÿä¼šãŒå¢—ãˆã¦ãã¾ã—ãŸã€‚
ã¾ãŸå€‹äººçš„ã«ã¯ï¼ˆå³å¯†ã«ã¯Validatorã§ã¯ãªã„ã§ã™ãŒ)ã€[`unknownutil`](https://github.com/jsr-core/unknownutil)ã‚‚æ‰‹ã«é¦´æŸ“ã‚“ã§ã‚ˆãä½¿ã£ã¦ã„ã¾ã™ã€‚

# æ—¢å­˜ã®Validation Library/TypeScriptã«è¶³ã‚Šãªã„ã‚‚ã®

TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã¯éå¸¸ã«å¼·åŠ›ã§ã™ã€‚
ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’é‡ã­ãŸçµæœã¨ã¦ã‚‚è±Šã‹ãªè¡¨ç¾åŠ›ã‚’æŒã¡ã€å‹ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ãƒãƒ¥ãƒ¼ãƒªãƒ³ã‚°å®Œå…¨ã§ã‚ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™^[https://github.com/Microsoft/TypeScript/issues/14833]ã€‚
å‹ãƒ‘ã‚ºãƒ«ã‚’é§†ä½¿ã™ã‚Œã°brainf\*\*k interpreter^[https://github.com/susisu/typefuck]ã§ã•ãˆæ›¸ã‘ã¦ã—ã¾ã„ã¾ã™ã€‚

ã—ã‹ã—ã€å‹ã‚·ã‚¹ãƒ†ãƒ ã¯å®Ÿè¡Œæ™‚ã«ã¯æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ã€‚ã¾ãŸã€TypeScriptã§ã¯åŸå‰‡ã¨ã—ã¦ã€Œå€¤ã‹ã‚‰å‹ã‚’ä½œã‚‹ã€ã“ã¨ã¯ã§ãã¾ã™ãŒã€ã€Œå‹ã‹ã‚‰å€¤ã‚’ä½œã‚‹ã€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

# å‹ã‹ã‚‰å€¤ã¸ã®å¤‰æ›ã®é™ç•Œ

TypeScriptã®å‹æƒ…å ±ã¯é–‹ç™ºæ™‚ã®å®‰å…¨æ€§ã‚’æä¾›ã—ã¾ã™ãŒã€å®Ÿè¡Œæ™‚ã«å‹•ä½œã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è€ƒãˆã¾ã™:

```ts
function someFunction(): any {}
const value: string = someFunction();
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯someFunctionã®æˆ»ã‚Šå€¤ãŒstringå‹ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«type assertionã‚„æ˜ç¤ºçš„ãªValidationãŒå¿…è¦ã§ã™ãŒã€å‹è‡ªä½“ã‹ã‚‰ãã®ã‚ˆã†ãªValidation logicã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

`zod`ã‚„`valibot`ãªã©ã®æ—¢å­˜ã®Validation Libraryã¯ã€TSã® Library ã¨ã—ã¦ç”¨æ„ã•ã‚ŒãŸDSLï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰è¨€èªï¼‰ã§ assertion ã‚’å®šç¾©ã—ã€ãã“ã‹ã‚‰TypeScriptã®å‹ã‚’ç”Ÿæˆ(æ¨è«–)ã™ã‚‹ã“ã¨ã§å‹å®‰å…¨ã‚’æ‹…ä¿ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã§ã¯æ—¢å­˜ã®å‹ã«å¯¾ã™ã‚‹ Validation é–¢æ•°ã‚’ç´ æœ´ãªæ–¹æ³•ã§ç”¨æ„ã§ããšã€DSLã‚’è¦šãˆã¦ã€ä¸€ã‹ã‚‰ Validation é–¢æ•°ã‚’ä½œã‚ŠãªãŠã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ãŸã‚å‹ã¨Validation LogicãŒåˆ†é›¢ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€TSã¨ã„ã†å‹ã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚‹ã®ã«ã€ã•ã‚‰ã«DSLã§å‹ã‚·ã‚¹ãƒ†ãƒ ã«æº–ã˜ã‚‹ã‚‚ã®ã‚’ä½œã‚Šç›´ã™ã®ã¯ç›´æ„Ÿçš„ã§ã¯ãªã„ã§ã™ã‚ˆã­ã€‚

# `Typia` ã¨ã¯

https://typia.io/

`Typia`ã¯ã€ã“ã®ã‚ˆã†ãªèª²é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

- é«˜é€Ÿ: `Typia`ã¯æ—¢å­˜ã®Validation Library ã«æ¯”ã¹ã¦éå¸¸ã«é«˜é€Ÿã§ã™ã€‚ã€Œ`zod`ã®1500å€é€Ÿã„ã€ã¨ã‚‚è¨€ã‚ã‚Œã¦ã„ã¾ã™^[https://zenn.dev/hr20k_/articles/3ecde4239668b2#%E9%80%9F%E5%BA%A6%E3%81%AE%E6%AF%94%E8%BC%83]ã€‚
- å‹æƒ…å ±ã‹ã‚‰ Validation ã‚’ç”Ÿæˆ: TypeScriptã®å‹æƒ…å ±ã‚’å…ƒã« Validation ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒå¿…è¦ã§ã™ãŒã€ã“ã‚Œã«ã‚ˆã‚Šå‹ãƒã‚§ãƒƒã‚¯ã®æ­£ç¢ºæ€§ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå‘ä¸Šã—ã¾ã™ã€‚
- ã‚·ãƒ³ãƒ—ãƒ«ãªè¨˜æ³•: ç‰¹å®šã® Library ç‰¹æœ‰ã®è¨˜æ³•ã‚’è¦šãˆã‚‹å¿…è¦ã¯ãªãã€TypeScriptã®æ¨™æº–çš„ãªå‹è¨˜è¿°ã‹ã‚‰ Validation ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
- å¤šæ©Ÿèƒ½: Validation ã ã‘ã§ãªãã€é«˜é€ŸãªJSONå¤‰æ›ã€JSON Schemaç”Ÿæˆã€ProtoBufç”Ÿæˆã€ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãªã©ã®æ©Ÿèƒ½ã‚‚æä¾›ã—ã¾ã™ã€‚

`Typia`ã®é«˜é€Ÿã•ã¯ç‰¹ç­†ã™ã¹ãç‚¹ã§ã‚ã‚Šã€å®Ÿéš›ã«ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸå¤§é‡ã®TypeScriptå‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ Validation ã‚’è¡Œã†å ´é¢ã§éå¸¸ã«æœ‰åŠ¹ã§ã—ãŸã€‚

ã—ã‹ã—ã€`Typia`ã®çœŸã®å¼·ã¿ã¯ã€**ã€Œç‹¬è‡ªã®è¨˜æ³•ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªã„ã“ã¨ã€** ã«ã‚ã‚Šã¾ã™ã€‚
ã“ã®ç‚¹ã¯æ—¢å­˜ã® Validation Library ã¨ã®å¤§ããªå·®åˆ¥åŒ–è¦å› ã§ã‚ã‚Šã€`Typia`ã®å°å…¥éšœå£ã‚’å¤§å¹…ã«ä¸‹ã’ã¦ã„ã¾ã™ã€‚
`Typia`ã‚’ä½¿ãˆã°ã€TypeScriptã®æ¨™æº–çš„ãªè¨˜è¿°ã«å¾“ã†ã ã‘ã§ã€è‡ªç„¶ã«Validationã‚„ä»–ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã‚‹ãŸã‚ã€æ–°ã—ã„Libraryã«åˆã‚ã›ã¦ãƒ«ãƒ¼ãƒ«ã‚„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚’è¦šãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
é–‹ç™ºè€…ã¯æ—¢å­˜ã®TypeScriptã®çŸ¥è­˜ã ã‘ã§`Typia`ã‚’ä½¿ã„ã“ãªã™ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ã€‚

`Typia`ã¯å®Ÿè¡Œæ™‚ã«æ¶ˆãˆå»ã‚‹é‹å‘½ã«åˆã£ãŸå‹æƒ…å ±ã«æ¯ã‚’å¹ãè¾¼ã‚€ Library ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

# `Typia` ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã‚ˆã†

## ã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹

æ‰‹å§‹ã‚ã«ç°¡å˜ãªä¾‹ã‹ã‚‰:

```ts
import typia from 'typia';

const b = typia.is<string>('hello world');
console.log(b);
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€`'hello world'`ãŒ`string`å‹ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
ã“ã‚Œã‚’`Typia`ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```ts
// ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰
import typia from 'typia';

const b = ((input: any): input is string => {
	return typeof input === 'string';
})('hello world');
console.log(b); // true
```

ã“ã®ã‚ˆã†ã«ã€`typia.is`ã¯ **å‹æƒ…å ±ã‹ã‚‰** Validationé–¢æ•°ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€importã•ã‚Œã¦ã„ã‚‹`typia`ã¯ã©ã“ã‹ã‚‰ã‚‚å‚ç…§ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ã“ã®ã‚ã¨bundlerã‚’æŒŸã‚€ã¨tree-shakingã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

## Objectå‹ã®ä¾‹

æ¬¡ã¯ã€ä¸€èˆ¬çš„ãªå‹ã«å¯¾ã—ã¦Validationã‚’è¡Œã†ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãª`Member`å‹ãŒã‚ã‚Šã€ãã‚Œã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
ã“ã“ã§ã¯Validationã‚’è¡Œã†é–¢æ•°ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«[`typia.is`](https://typia.io/docs/validators/is/)ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

```typescript
// å…ƒã®ã‚³ãƒ¼ãƒ‰
import typia from 'typia';

type Member = {
	/**
  * @format uuid
  */
	id: string;

	/**
  * @type uint32
  * @minimum 20
  * @exclusiveMaximum 100
  */
	age: number;

	name: string;

	time?: Date;
};

const member = { id: '', name: 'taro', age: 20 } as const satisfies Member;
console.log(typia.is<Member>(member)); // false
```

ã“ã‚Œã‚’`Typia`ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
å°‘ã—é•·ã„ã®ã§æŠ˜ã‚ŠãŸãŸã‚“ã§ã„ã¾ã™ã€‚

<details>
<summary>ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰</summary>

```typescript
// Typiaã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰
import typia from 'typia';
// â†ã‚‚ã¯ã‚„`typia`ã¯ä½¿ç”¨ã•ã‚Œã¦ãªã„ã®ã§tree-shakingã®å¯¾è±¡ã«ãªã‚‹
type Member = {
	/**
	 * @format uuid
	 */
	id: string;
	/**
	 * @type uint32
	 * @minimum 20
	 * @exclusiveMaximum 100
	 */
	age: number;
	name: string;
	time?: Date;
};
const member = { id: '', name: 'taro', age: 20 } as const satisfies Member;
console.log(
	((input: any): input is Member => {
		const $io0 = (input: any): boolean =>
			typeof input.id === 'string'
			&& /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i.test(
				input.id,
			)
			&& typeof input.age === 'number'
			&& Math.floor(input.age) === input.age
			&& input.age >= 0
			&& input.age
			/**
			 * @format uuid
			*/ <= 4294967295
			 && input.age >= 20
			&& input.age < 100
       && typeof input.name === 'string'
      && (undefined === input.time || input.time instanceof Date);
		return typeof input === 'object' && input !== null && $io0(input);
	})(member),
); // false
```

</details>

ã¾ãŸ`typia`ã«ã¯JSDocã®ä»£ã‚ã‚Šã«`tag`ã‚’ç”¨ã„ã‚‹åˆ¥ã®æ›¸ãæ–¹ã‚‚ã‚ã‚Šã¾ã™ã€‚
ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ã§ã™ãŒã€Editorä¸Šã§è£œå®ŒãŒåŠ¹ãã®ã§ä¾¿åˆ©ã§ã™ã€‚

```typescript
import typia, { tags } from 'typia';

type Member = {
	id: string & tags.Format<'uuid'>;
	name: string;
	time?: Date;
	age: number
		& tags.Type<'uint32'>
		& tags.Minimum<20>
		& tags.ExclusiveMaximum<100>;
};

const member = { id: '', name: 'taro', age: 20 } as const satisfies Member;
console.log(typia.is<Member>(member)); // false
```

å‹é–¢æ•°ã‚’ç”¨ã„ãŸã‚ˆã‚Šè¤‡é›‘ãªå‹ã«å¯¾ã—ã¦ã‚‚Validationé–¢æ•°ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

<details>
<summary>æ¯”è¼ƒçš„è¤‡é›‘ãªå‹ã®ä¾‹</summary>

```typescript
// å…ƒã®ã‚³ãƒ¼ãƒ‰
import typia from 'typia';

type D = {
	/**
  * @format uuid
  */
	id: string;

	age?: number | null;
};

type Member = {
	name: string;
	id: string;
	details: D;
};

type ValidateType = Pick<Member, 'details'> & Omit<Member, 'id'>;

console.log(typia.is<ValidateType>({} as unknown)); // false
```

```typescript
// ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰
type D = {
	/**
	 * @format uuid
	 */
	id: string;
	age?: number | null;
};
type Member = {
	name: string;
	id: string;
	details: D;
};
type ValidateType = Pick<Member, 'details'> & Omit<Member, 'id'>;
console.log(
	((input: any): input is ValidateType => {
		const $io0 = (input: any): boolean =>
			typeof input.details === 'object'
			&& input.details !== null
			&& $io1(input.details)
			&& typeof input.name === 'string';
		const $io1 = (input: any): boolean =>
			typeof input.id === 'string'
			&& /^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i.test(
				input.id,
			)
			&& (input.age === null
				|| undefined === input.age
				|| typeof input.age === 'number');
		return typeof input === 'object' && input !== null && $io0(input);
	})({} as unknown),
); // false
```

</details>

`Typia`ã®Documentã«ã¯PlaygroundãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚
https://typia.io/playground/

è©³ç´°ãªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://zenn.dev/hr20k_/articles/3ecde4239668b2

# Typiaã®å°å…¥ã®èª²é¡Œ

ã“ã‚Œã¾ã§`Typia`ã‚’ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€ã„ãã¤ã‹ã®ãƒãƒ¼ãƒ‰ãƒ«ãŒå¿…è¦ã§ã—ãŸã€‚

`Typia`ã«ã¯ï¼’ã¤ã®ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚Transformationãƒ¢ãƒ¼ãƒ‰ã¨Generationãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚

- Transformationãƒ¢ãƒ¼ãƒ‰: `tsc`ã®Transform APIã‚’ä½¿ã£ã¦å‹æƒ…å ±ã‹ã‚‰Validationã‚’ç”Ÿæˆã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã€‚`tsc`å®Ÿè¡Œæ™‚ã«Validationã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚
- Generationãƒ¢ãƒ¼ãƒ‰: `Typia`ã®CLIã‚’ä½¿ã£ã¦å‹æƒ…å ±ã‹ã‚‰Validationã‚’ç”Ÿæˆã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã€‚BundlerãŒ`tsc`ã‚’ä½¿ã‚ãªã„å ´åˆã«ä½¿ã†ã€‚

ç™–ãŒãªããƒãƒã‚Šãšã‚‰ã„ã®ã¯Generationãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚
`Typia`ã®CLIã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰`import`ã™ã‚‹ã ã‘ã§ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ã—ã‹ã—ã€ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ãŒä¸€ã¤å¢—ãˆã¾ã™ã—ã€ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚‚å¢—ãˆã‚‹ã®ã§ã§ãã‚Œã°Transformationãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã„ãŸã„ã§ã™ã‚ˆã­ã€‚

ã¨ã“ã‚ãŒTransformationãƒ¢ãƒ¼ãƒ‰ã¯å°å…¥ã®ãƒãƒ¼ãƒ‰ãƒ«ãŒé«˜ã„ã§ã™ã€‚

ç›´æ¥`tsc`ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å ´åˆã¯å°å…¥ãŒç°¡å˜ã§ã™ãŒã€ä»–ã®Bundlerã‚’ä½¿ã†å ´åˆã«ã¯ã‚ã‚‰ã‹ã˜ã‚`tsc`ã‚’çµŒç”±ã—ã¦Bundleã™ã‚‹ã‚ˆã†ã«è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

<details>
<summary>viteã®ä¾‹</summary>

```typescript
import react from '@vitejs/plugin-react';
import typescript from 'rollup-plugin-typescript2';
import { defineConfig } from 'vite';

// https://vitejs.dev/config/
export default defineConfig({
	esbuild: false,
	plugins: [
		react(),
		typescript(),
	],
});
```

</details>

ãŸã æ‰‹å…ƒã ã¨ã†ã¾ãå‹•ã‹ãªã„ã“ã¨ã‚‚å¤šã‹ã£ãŸã§ã™ã€‚ç‰¹ã«`ts`/`tsx`ä»¥å¤–ã®`html-ish`ãªè¨€èª^[https://biomejs.dev/blog/biome-v1-6/#partial-support-for-astro-svelte-and-vue-files]ã€ä¾‹ãˆã°`svelte`ã‚„`vue`ãªã©ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ç‰¹ã«å•é¡ŒãŒå¤šã‹ã£ãŸã§ã™ã€‚

https://github.com/samchon/typia/issues/812

ãã®ãŸã‚ `Webpack` ãªã©ã®Bundlerã‚’ç”¨ã„ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ( `Next.js` ãªã© )ã§ã¯ã€`tsc`ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’ã—ã¦ã„ãªã„ãŸã‚ã€Generationãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

Generationãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€ã¾ã‚ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ãŒä¸€ã¤å¢—ãˆã¾ã™ã—ã€ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚‚å¢—ãˆã‚‹ã®ã§ã€ã§ãã‚Œã°Transformationãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã„ãŸã„ã§ã™ã‚ˆã­ã€‚

# unplugin-typia

ãã“ã§ã€ç§ã¯[`unplugin-typia`](https://jsr.io/@ryoppippi/unplugin-typia) ã‚’ä½œã‚Šã¾ã—ãŸã€‚

https://github.com/ryoppippi/unplugin-typia
https://jsr.io/@ryoppippi/unplugin-typia

`unplugin-typia` ã¯ [`unplugin`](https://unplugin.unjs.io/) ã¨`tsc`ã‚’çµ„ã¿åˆã‚ã›ã¦ä½œã£ã¦ã„ã¾ã™ã€‚
`unplugin` ã¨ã¯ã€`Vite` ã‚„ `esbuild`ã€`webpack` ãªã©ã®è¤‡æ•°ã®bundlerã«å¯¾å¿œã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…±é€šã®APIã§ä½œã‚‹ãŸã‚ã®Libraryã§ã™ã€‚

`unplugin-typia`ã‚’ä½¿ã†ã¨ã€è¤‡é›‘ãªè¨­å®šã‚’ã™ã‚‹ã“ã¨ãªãã€bundlerã§typiaã®Transform ãƒ¢ãƒ¼ãƒ‰ç›¸å½“ã®ä½“é¨“ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> [!NOTE]
> ãã‚Œãã‚Œã®bundlerã®è©³ã—ã„èª¬æ˜ã¯[JSRä¸Šã®doc](https://jsr.io/@ryoppippi/unplugin-typia/doc)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
> ã¾ãŸ[examples](https://github.com/ryoppippi/unplugin-typia/tree/main/examples)ã«ã¯å„bundlerã”ã¨ã®ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚
> ã•ã‚‰ã«ã„ãã¤ã‹ã®ã‚µãƒ³ãƒ—ãƒ«ã«ã¤ã„ã¦ã¯å®Ÿéš›ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
>
> | bundler                                     | deploy site                                                      | GitHub                                                                                             |
> | ------------------------------------------- | ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
> | [Vite](https://vitejs.dev/)                 | [Cloudflare pages](https://unplugin-typia-vite-react.pages.dev/) | [`examples/vite-react`](https://github.com/ryoppippi/unplugin-typia/blob/main/examples/vite-react) |
> | [Vite + Sveltekit](https://kit.svelte.dev/) | [Cloudflare pages](https://unplugin-typia-sveltekit.pages.dev/)  | [`examples/sveltekit`](https://github.com/ryoppippi/unplugin-typia/blob/main/examples/sveltekit)   |
> | [Vite + Hono](https://hono.dev/)            | [Cloudflare pages](https://unplugin-typia-vite-hono.pages.dev/)  | [`examples/vite-hono`](https://github.com/ryoppippi/unplugin-typia/blob/main/examples/vite-hono)   |
> | [Next.js](https://nextjs.org/)              | [Vercel](https://unplugin-typia-nextjs.vercel.app/)              | [`examples/nextjs`](https://github.com/ryoppippi/unplugin-typia/tree/main/examples/nextjs)         |
>
> _(Vite + Honoã¯APIã®ã¿ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã™ã€‚`README.md`ã‚’èª­ã‚“ã§`curl`ã—ã¦ã­ï¼)_

# å®Ÿéš›ã«`unplugin-typia`ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†

ã§ã¯ç°¡å˜ã«`unplugin-typia`ã¨`Typia`ã‚’ä½¿ã£ã¦éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

## `Bun` ã¨ä¸€ç·’ã«ä½¿ã£ã¦ã¿ã‚‹

ä¸€ç•ªæ‰‹ã£å–ã‚Šæ—©ãä½¿ã†æ–¹æ³•ã¯[`Bun.build`](https://bun.sh/docs/bundler)ã‚’ä½¿ã†ã“ã¨ã§ã™ã€‚

Githubä¸Šã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ãŸã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

https://github.com/ryoppippi/bun-typia-template

```bash
git clone https://github.com/ryoppippi/bun-typia-template
cd bun-typia-template
bun i

# ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œ
bun run index.ts

# ã‚‚ã—ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œã—ãŸã„å ´åˆ
bun run build # build.tsã‚’å®Ÿè¡Œã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ã€‚`./out`ã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã‚‹
bun run ./out/index.js
# ã‚‚ã—ãã¯
node ./out/index.js
```

ã“ã‚Œã ã‘ã§ã€`Typia`ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¨ã£ã¦ã‚‚ç°¡å˜ã§ã™ã­ã€‚

## `Vite` + `Hono` + `unplugin-typia`ã§ä½¿ã£ã¦ã¿ã‚‹

æ¬¡ã«ã€`Vite`ã¨[`Hono`](https://hono.dev/)ã¨`unplugin-typia`ã‚’ä½¿ã£ã¦éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
npm create hono@latest ./my-app -- --template cloudflare-pages
cd my-app
npm install
```

æ¬¡ã«ã€`unplugin-typia`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
`unplugin-typia`ã¯`JSR`ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`jsr` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npx jsr add -D @ryoppippi/unplugin-typia
```

ãã—ã¦`typia`ã‚’å°å…¥ã—ã¾ã™ã€‚[Typiaã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://typia.io/docs/setup/#unplugin-typia)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

```bash
npm i typia # typiaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npx typia setup # typiaã®setup wizardã‚’å®Ÿè¡Œ
npm i @hono/typia-validator --force # honoã®typia-validatorã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```

ã“ã‚Œã§æº–å‚™ãŒã§ãã¾ã—ãŸã­ï¼

### `unplugin-typia`ã®è¨­å®šã‚’ã™ã‚‹

`unplugin-typia`ã¯`vite`ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ä½¿ã„ã¾ã™ã€‚
`vite.config.ts`ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```diff ts
 import build from '@hono/vite-cloudflare-pages'
 import devServer from '@hono/vite-dev-server'
 import adapter from '@hono/vite-dev-server/cloudflare'
 import { defineConfig } from 'vite'
+import UnpluginTypia from '@ryoppippi/unplugin-typia/vite';

 export default defineConfig({
   plugins: [
     build(),
+    UnpluginTypia(), // unplugin-typiaã‚’è¿½åŠ 
     devServer({
       adapter,
       entry: 'src/index.tsx'
     })
   ]
 })
```

### `Typia`ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ã‚‹

ã§ã¯ã€`src/index.tsx`ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```diff ts
 import { Hono } from 'hono'
 import { renderer } from './renderer'
+import typia from 'typia'
+import { typiaValidator } from '@hono/typia-validator'

+interface Props {
+  name: string
+}

 const app = new Hono()

 app.use(renderer)

 app.get('/', (c) => {
   return c.render(<h1>Hello!</h1>)
 })

+app.post('/',
+  typiaValidator('json', typia.createValidate<Props>()),
+  (c) => {
+    const data = c.req.valid('json');
+
+    return c.json({
+      success: true,
+      message: `Hello ${data.name}!`
+    })
+  }
+)

 export default app
```

ã“ã‚Œã§æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### å®Ÿè¡Œã—ã¦ã¿ã‚‹

ãã‚Œã§ã¯ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ npm run dev

> dev
> vite

 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚                                  â”‚
 â”‚  [unplugin-typia] Cache enabled  â”‚
 â”‚                                  â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

(!) Could not auto-determine entry point from rollupOptions or html files and there are no explicit optimizeDeps.include patterns. Skipping dependency pre-bundling.

  VITE v5.2.13  ready in 588 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
```

ç„¡äº‹ã€èµ·å‹•ã§ãã¾ã—ãŸã­ï¼

ãã‚Œã§ã¯ã€APIã‚’å©ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

`curl`ã‚’ä½¿ã£ã¦ã‚‚ã„ã„ã®ã§ã™ãŒè¨˜è¿°ãŒé•·ããªã‚‹ã®ã§ã€ã“ã“ã§ã¯[`xh`](https://github.com/ducaale/xh)ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ xh :5173 name=ryoppippi
HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 45
Content-Type: application/json; charset=UTF-8
Date: Wed, 12 Jun 2024 11:14:19 GMT
Keep-Alive: timeout=5

{
    "success": true,
    "message": "Hello ryoppippi!"
}
```

ç„¡äº‹ã€ValidationãŒé€šã‚Šã€APIãŒå©ã‘ã¾ã—ãŸã­ï¼

è©¦ã—ã«`name`ã‚’æ–‡å­—åˆ—ã§ã¯ãªãæ•°å€¤ã§é€ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ xh :5173 name:=5
HTTP/1.1 400 Bad Request
Connection: keep-alive
Content-Length: 80
Content-Type: application/json; charset=UTF-8
Date: Wed, 12 Jun 2024 11:15:58 GMT
Keep-Alive: timeout=5

{
    "success": false,
    "error": [
        {
            "path": "$input.name",
            "expected": "string",
            "value": 5
        }
    ]
}
```

Validation Error ãŒè¿”ã£ã¦ãã¾ã—ãŸã­ï¼

### Cloudflare Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã‚‹

æœ€å¾Œã«ã€Cloudflare Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ npm run deploy
$ $npm_execpath run build && wrangler pages deploy
$ vite build

 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚                                  â”‚
 â”‚  [unplugin-typia] Cache enabled  â”‚
 â”‚                                  â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

vite v5.2.13 building SSR bundle for production...
âœ“ 50 modules transformed.
dist/_worker.js  67.14 kB
âœ“ built in 167ms                                                                                                                                                                                                          The project you specified does not exist: "hono-vite". Would you like to create it?"
â¯ Create a new project
âœ” Enter the production branch name: â€¦ main
âœ¨ Successfully created the 'hono-vite' project.
ğŸŒ  Uploading... (1/1)

âœ¨ Success! Uploaded 1 files (1.61 sec)

âœ¨ Compiled Worker successfully
âœ¨ Uploading Worker bundle
âœ¨ Uploading _routes.json
ğŸŒ Deploying...
âœ¨ Deployment complete! Take a peek over at https://xxx.pages.dev
```

ç„¡äº‹ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã—ãŸã­ï¼
ã‚ã¨ã¯ã“ã®URLã‚’å®Ÿéš›ã«å‘¼ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ xh https://xxx.pages.dev name=ryoppippi

# çœç•¥

{
    "success": true,
    "message": "Hello ryoppippi!"
}
```

ç„¡äº‹ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸAPIãŒå©ã‘ã¾ã—ãŸã­ï¼

# ã¾ã¨ã‚

- `unplugin-typia`ã‚’ä½¿ã†ã¨`Typia`ã®å°å…¥ãŒç°¡å˜ã«ãªã‚Šã¾ã™
- `Vite`ã€`esbuild`ã€`webpack`ãªã©ã®bundlerã«å¯¾å¿œã—ã¦ã„ã¾ã™
- `Typia`ã¯æ¥½ã—ã„
- `Typia`ã¯é¢ç™½ã„ï¼

ãœã²`Typia`ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼

# Appendix

## `jsonup` + `typia`

`jsonup`ã¯TypeScriptã§æ›¸ã‹ã‚ŒãŸJSON Parserã§ã™ã€‚
JSONå½¢å¼ã®Literal Stringã‚’ä¸ãˆã‚‹ã¨å‹æ¨è«–ã‚’è¡Œã†ã¨ã„ã†ã€è¬æŠ€è¡“ Library ã§ã™ï¼ˆæœ¬äººæ›°ããƒã‚¿ã§ä½œã£ãŸãã†ã§ã™ãŒã€TypeScriptã®Compilerã®é™ç•Œã«æŒ‘æˆ¦ã—ã¦ã‚‹æ„ŸãŒå¥½ãã§ã™ï¼‰ã€‚

https://github.com/tani/jsonup

ãã—ã¦ã€`jsonup`ã¨`typia`ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ãªã‚“ã¨ã€æ–‡å­—åˆ—ã‹ã‚‰validationé–¢æ•°ãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã„ã†ã€ãªã‚“ã¨ã‚‚ä¸æ€è­°ãªã“ã¨ãŒã§ãã¾ã™ã€‚

https://x.com/ryoppippi/status/1800183030235255019

`typia`ã«ã¯random generatorãŒã¤ã„ã¦ã„ã‚‹ã®ã§ã€JSONã®æ–‡å­—åˆ—ã‚’ä¾‹ã¨ã—ã¦ä¸ãˆã‚‹ã¨ãã‚Œã«åˆè‡´ã™ã‚‹ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’ç”Ÿæˆã™ã‚‹ã€ãªã‚“ã¦ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```ts
import type { ObjectLike } from 'jsonup';
import typia from 'typia';

const jsonSample = `{ "name": "jsonup", "age": 34}`;

/**
 * type Obj = {
 *    name: string;
 *    age: number;
 * }
 */
type Obj = ObjectLike<typeof jsonSample>;

console.log(typia.random<Obj>());
```

```sh

$ bun run ./index.ts
{ name: 'dvdnp', age: 49.25475568792122 }
$ bun run ./index.ts
{ name: 'htgywkaq', age: 13.818270173692525 }
$ bun run ./index.ts
{ name: 'pyurujgkvd', age: 47.19975642889989 }
```

https://github.com/ryoppippi/bun-typia-jsonup-experiments

GitHubã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’è½ã¨ã›ã‚‹ã®ã§ãœã²éŠã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

è‡ªåˆ†ã¯`jsonup`ã‚„`type-fest`ã®ã‚ˆã†ãªå‹ãƒ‘ã‚ºãƒ«ã® Library ãŒå¤§å¥½ããªã®ã§ã€ã“ã‚Œã‚‰ã«æ¯ã‚’å¹ãè¾¼ã‚ã‚‹ã‚ˆã†ãª`typia`ã¯ã¨ã¦ã‚‚æ¥½ã—ã„ã§ã™ã€‚

## `typefuck` + `typia`

[`typefuck`](https://github.com/susisu/typefuck) ã¨ã¯ã€å‹ãƒ¬ãƒ™ãƒ«ã§å®Ÿè£…ã•ã‚ŒãŸBrainfuck interpreterã§ã™ã€‚

https://github.com/susisu/typefuck

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒãƒ¥ãƒ¼ãƒªãƒ³ã‚°å®Œå…¨ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã®ã§ã™ãŒã€ã“ã¡ã‚‰ã‚‚`Typia`ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import type { Brainfuck } from '@susisu/typefuck';
import typia from 'typia';

type Program = '>, [>, I<[.<]';
type Input = 'Hello, world!';
type Output = Brainfuck<Program, Input>;

console.log(typia.is<Output>('!drow ,olleH')); // true
```

## `type-fest` + `typia`

[`type-fest`](https://github.com/sindresorhus/type-fest)ã¨ã¯ã€TypeScriptã§å‹ã‚’æ“ä½œã™ã‚‹æ™‚ã®ä¾¿åˆ©é–¢æ•°ã‚’é›†ã‚ãŸLibraryã§ã™ã€‚

https://github.com/sindresorhus/type-fest

ãŸã¨ãˆã°ã€xor^[https://ja.wikipedia.org/wiki/%E6%8E%92%E4%BB%96%E7%9A%84%E8%AB%96%E7%90%86%E5%92%8C]ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®å‹ã¨ã—ã¦`MergeExclusive`ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’`Typia`ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ãã‚Œãã‚Œã®keyã«å¯¾ã—ã¦æ’ä»–çš„ãªObjectå‹ãŒã§ãã‚ãŒã‚Šã¾ã™ã€‚

```ts
import type { MergeExclusive, SimplifyDeep } from 'type-fest';
import typia from 'typia';

type ExclusiveVariation1 = {
	exclusive1: boolean;
};

type ExclusiveVariation2 = {
	exclusive2: string;
};

type ExclusiveOptions = SimplifyDeep<
	MergeExclusive<
		ExclusiveVariation1,
		ExclusiveVariation2
	>
>;

const is = typia.createIs<ExclusiveOptions>();

console.log(is({ exclusive1: true })); // true
console.log(is({ exclusive2: 'string' })); // true
console.log(is({ exclusive1: true, exclusive2: 'string' })); // false
```

<details>
<summary>ExclusiveOptionsã®å‹</summary>

```ts
type ExclusiveOptions = {
	exclusive1?: undefined;
	exclusive2: string;
} | {
	exclusive2?: undefined;
	exclusive1: boolean;
};
```

</details>

ã¾ãŸã€`IntRange`ã¨ã„ã†å‹ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®å‹ã¯æŒ‡å®šã•ã‚ŒãŸç¯„å›²ã®æ•´æ•°ã‚’è¡¨ã—ã¾ã™ã€‚
ã“ã‚Œã‚’ä½¿ã£ã¦ã€1ã‚±ã‚¿ã®æ•°å­—ã‚’è¡¨ã™å‹ã‚’ä½œã‚Šã€Validationé–¢æ•°ã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ã•ã‚‰ã«ã€`random`é–¢æ•°ã‚’ä½¿ã£ã¦ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã‚’ç”Ÿæˆã—ã¦ã¿ã¾ã™ã€‚

```ts
import type { IntRange } from 'type-fest';
import typia from 'typia';

type Digit = IntRange<0, 10>; // 0 <= Digit < 10

const is = typia.createIs<Digit>();

console.log(is(5)); // true
console.log(is(11)); // false
console.log(is(-1)); // false

console.log(typia.random<Digit>()); // 5 (or any other number between 0 and 9)
```

<details>
<summary>randomé–¢æ•°ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœ</summary>

```ts
console.log(((generator) => {
	const $pick = typia.random.pick;
	return $pick([
		() => 0,
		() => 1,
		() => 2,
		() => 3,
		() => 4,
		() => 5,
		() => 6,
		() => 7,
		() => 8,
		() => 9
	])();
})());
```

</details>

è‡ªåˆ†ã®çŸ¥ã‚‹é™ã‚Šã€å¾“æ¥å‹ã®Validation Libraryã§ã“ã®ã‚ˆã†ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã‚“ã ã¨ã—ã¦ã‚‚ã€ãã‚ŒãŒå‹ï¼ˆ`z.infer<foo>`ãªã©ï¼‰ã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚
ãŸã¨ãˆã°`zod`ã§ã‚ã‚Œã°

```ts
import { IntRange } from 'type-fest';
import { z } from 'zod';

const digit = z.number().int().min(0).max(10).transform(x => (x as IntRange<0, 10>));
```

ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯å‹ã¨Validation LogicãŒåˆ†é›¢ã—ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã‚ˆã­ã€‚

`Typia`ã¯å‹æƒ…å ±ã‹ã‚‰Validation Logicã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã€å‹ã¨Validation LogicãŒä¸€ä½“ã¨ãªã£ã¦ã„ã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚

> [!NOTE]
> `Digit`ã®ä¾‹ã¯ã€ä¸€å¿œ`Typia`ã®è¨˜æ³•ã‚’ä½¿ã†ã¨
>
> ```ts
> import {'\{'} tags {'\}'} from 'typia';
> type Digit = number
>  & tags.Type<'uint32'>
>  & tags.Minimum<0>
>  & tags.ExclusiveMaximum<10>
> ```
>
> ã¨æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚
>
> `Typia`è¨˜æ³•ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ
>
> - ç¯„å›²ã§æŒ‡å®šãŒã§ãã‚‹(`type-fest`ã¯unionå‹ãªã®ã§)
> - ç¯„å›²æŒ‡å®šã®æ–¹ãŒJSON Schemaç­‰ã®ç”Ÿæˆã«æœ‰åˆ©(`type-fest`ã ã¨unionå‹ãªã®ã§ã¨ã‚Šã†ã‚‹æ•°å­—ãŒå…¨ã¦åˆ—æŒ™ã•ã‚Œã‚‹...)
>
> `type-fest`è¨˜æ³•ã‚’ä½¿ã†ãƒ¡ãƒªãƒƒãƒˆ
>
> - Editor ä¸Šã§è£œå®ŒãŒåŠ¹ã(å–ã‚Šã†ã‚‹å€¤ãŒå€‹åˆ¥ã® Literal å‹ã¨ã—ã¦å‹æƒ…å ±ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼‰
> - ç¯„å›²å¤–ã®æ•°å€¤ã«å¯¾ã—ã¦Editor ä¸Šã§å‹ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹(å–ã‚Šã†ã‚‹å€¤ãŒå‹æƒ…å ±ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼‰

## `zod`/`valibot`ã¨ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®æ¯”è¼ƒ

å…ˆã»ã©ã®`Typia`ã§ã®å®Ÿè£…ä¾‹ã‚’`zod`ã¨`valibot`ã§æ›¸ã„ãŸä¾‹ã¨æ¯”è¼ƒã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```typescript
import { z } from 'zod';

const Member = z.object({
	id: z.string().uuid(),
	age: z.number().int().min(20).max(99),
	name: z.string(),
	time: z.date().optional(),
});

type Member = z.infer<typeof Member>;

const member = { id: '', name: 'taro', age: 20 } as const satisfies Member;

console.log(Member.parse(member));
```

```typescript
import * as v from 'valibot';

const Member = v.object({
	id: v.pipe(v.string(), v.uuid()),
	age: v.pipe(
		v.number(),
		v.integer(),
		v.minValue(20),
		v.maxValue(99) // exclusiveã®ä»£ã‚ã‚Šã«-1ã—ã¦ãŠã
	),
	name: v.string(),
	time: v.optional(v.date()),
});

type Member = v.InferOutput<typeof Member>;

const member = { id: '', name: 'taro', age: 20 } as const satisfies Member;

console.log(v.is(Member, member));
```

| Library   | ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º |
| --------- | -------------- |
| `typia`   | **0.563 kb**   |
| `zod`     | 117 kb         |
| `valibot` | 8.50kb         |

ã¨ã¦ã‚‚å°ã•ã„ã§ã™ã­ï¼

## bundle sizeã«ã¤ã„ã¦è£œè¶³

ç¾åœ¨ã®å®Ÿè£…ã§ã‚‚`createIs`ã¨ã„ã†å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã®é–¢æ•°ã‚’ç”Ÿæˆã™ã‚‹å ´åˆã¯ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒã¨ã¦ã‚‚å°ã•ã„ã§ã™ã€‚
ã—ã‹ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’ç”Ÿæˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãªãœã‹ãã“ã«Random Generatorã‚’å«ã‚ã¦ã—ã¾ã„ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã£ã¦ã—ã¾ã†ã‚ˆã†ã§ã™ã€‚
ãŠãã‚‰ã`zod`ã¨åŒã˜ã‚ˆã†ã« Library ã®ã‹ãªã‚Šã®éƒ¨åˆ†ã‚’å·»ãè¾¼ã‚“ã§ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
ãã‚Œã§ã‚‚`zod`ã‚ˆã‚Šã¯å…¨ç„¶å°ã•ã„ã§ã™ãŒ...
(ä½™è«‡ã§ã™ãŒã€[ `zod`ã‚‚æ¬¡ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’å‰Šæ¸›ã™ã‚‹äºˆå®šã§ã™ ](https://github.com/colinhacks/zod/pull/2850))

ã“ã‚Œã«ã¤ã„ã¦ã¯ `Typia` ã¯ç¾åœ¨å†…éƒ¨ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€å…ˆæ—¥ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ`v6.1.0`ã§ã¯ã€æœ¬æ ¼çš„ã« `Typia` ãŒ ESM ã«å¯¾å¿œã—ã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€Validationã®é–¢æ•°ã®ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã¯æ‰‹å…ƒã ã¨2/3ã»ã©ã«ãªã‚Šã¾ã—ãŸã€‚

https://github.com/samchon/typia/releases/tag/v6.1.0

## é–‹ç™ºç’°å¢ƒã«ã¤ã„ã¦

<details>
<summary>ã²ã¨ã‚Šã”ã¨</summary>

ä»Šå›ã® `unplugin-typia` ã¯ `npm` ã§ã¯ãªã `JSR` ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
`JSR` ã¯ `npm` ã¨åŒã˜ã‚ˆã†ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬é–‹ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ãŒã€`npm` ã¨ã¯ç•°ãªã‚Šã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ `package.json` ã®ç”Ÿæˆã‚„ TypeScript ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’é–‹ç™ºè€…ã®ä»£ã‚ã‚Šã«è¡Œã£ã¦ãã‚Œã‚‹ã®ã§ã€ Libaray ã®å…¬é–‹ãŒã¨ã¦ã‚‚ç°¡å˜ã§ã™ã€‚
æ¬ ç‚¹ã¨ã—ã¦ESMã«ã—ã‹å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ã€ä¾‹ãˆã° `Webpack` ã®è¨­å®šã‚’æ›¸ãã¨ãã¯ç›´æ¥ `require` ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ãŒã€[`jiti`](https://jiti.unjs.io/) ãªã©ã‚’çµŒç”±ã™ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
å®Ÿéš›ã€[Webpackã®å°å…¥æ–¹æ³•](https://jsr.io/@ryoppippi/unplugin-typia/doc/webpack/~/default) ã§ã¯ `jiti` ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ `Bun` ã‚’ä½¿ã£ã¦é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚
`Bun` ã¯ TypeScript ã‚’ãã®ã¾ã¾importã€å®Ÿè¡Œã§ãã‚‹ã®ã§ã¨ã¦ã‚‚æ¥½ã§ã—ãŸã€‚

çµæœçš„ã« bundler å‘ã‘ã® plugin ã‚’ä½œã£ã¦ã„ã‚‹ã®ã«è‡ªåˆ†ã¯ä¸€åˆ‡ bundler ã‚’ä½¿ã‚ãªã„ã€ã¨ã„ã†è¬ãªçŠ¶æ³ã«ãªã£ã¦ã„ã¾ã™ãŒã€é–‹ç™ºä½“é¨“ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒè‰¯ã‹ã£ãŸã§ã™ã€‚

ã¾ã‚`unplugin-typia` ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãŒ `Bun` ã§ã‚ã‚‹å¿…è¦ã‚‚ç‰¹ã«ãªã„ã®ã§ã€`node_modules` ã‚’ç®¡ç†ã—ãªãã¦æ¸ˆã‚€ `Deno` ã«ç§»è¡Œã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
`Deno` ã‚‚ç›´æ¥ TypeScript ã‚’å®Ÿè¡Œã§ãã¾ã™ã—ã€ä½•ã‚ˆã‚Š `JSR` ã¨ã®ç›¸æ€§ã¯æŠœç¾¤ã§ã™ã‹ã‚‰ã­ã€‚

</details>

## ãƒªãƒ³ã‚¯ãªã©

- [Typia](https://typia.io/)
- [Typia Setup Guide](https://typia.io/docs/setup/#unplugin-typia)
- [ä½œè€…ã«ã‚ˆã‚‹Typiaã«ã¤ã„ã¦ã®è§£èª¬è¨˜äº‹](https://dev.to/samchon/typescript-json-is-10-1000x-times-faster-than-zod-and-io-ts-8n6)
- [unplugin-typia](https://jsr.io/@ryoppippi/unplugin-typia)
- [unplugin-typia/examples](https://github.com/ryoppippi/unplugin-typia/tree/main/examples)
- [bun-typia-template](https://github.com/ryoppippi/bun-typia-template)
- [bun-typia-jsonup-experiments](https://github.com/ryoppippi/bun-typia-jsonup-experiments)
