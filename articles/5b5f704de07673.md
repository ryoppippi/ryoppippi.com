---
title: "Neovim + oil.nvim + Weztermã§é ‘å¼µã£ã¦ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["neovim", "oilnvim", "wezterm"]
published: true
published_at: 2024-04-24 00:00
publication_name: "vim_jp"
---

::: message
ã“ã®è¨˜äº‹ã¯[Vim é§…ä¼](https://vim-jp.org/ekiden/)ã® 4/24 ã®è¨˜äº‹ã§ã™ã€‚
:::

# TLDR
![1.gif](/images/5b5f704de07673/1.gif)
*oil.nvimã§ç”»åƒã‚’é¸æŠã—ã€Weztermã§ç”»åƒã‚’è¡¨ç¤ºã€‚ ç”»åƒã¯[ã“ã¡ã‚‰](https://x.com/sawaratsuki1004/status/1782079506083381657)ã‹ã‚‰*

- Neovimã§ç”»åƒã¨å‘ãåˆã†æ–¹æ³•ã‚’ç´¹ä»‹
- Quicklookã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã¯ç°¡å˜
- ä»Šå›ã¯Weztermã¨oil.nvimã‚’ãƒ•ãƒ«æ´»ç”¨ã—ã¦ã€Terminalä¸Šã§ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã‚’ãƒ¡ã‚¤ãƒ³ã«ç´¹ä»‹

# ã¯ã˜ã‚ã«

VimmerãŸã‚‹ã‚‚ã®ã€æ™®æ®µã¯Terminalã«å¼•ãã“ã‚‚ã£ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚
ç‰¹ã«Vim(Neovim)ä¸Šã§ä½œæ¥­ã‚’ã™ã‚‹ã“ã¨ãŒå¤šã„ã¯ãšã€‚

ã—ã‹ã—ã€TerminalãŒè‹¦æ‰‹ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚
ã”å­˜ã˜ã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

ã“ã‚Œã¾ã§ã€è‡ªåˆ†ã¯ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ãŸã„ã¨ãã¯
- `open`ã‚³ãƒãƒ³ãƒ‰ã§ç”»åƒã‚’é–‹ã(Macãªã‚‰Previewã§é–‹ã)
- `open .`ã§Finderã‚’é–‹ã„ã¦ç”»åƒã‚’è¦‹ã‚‹

ã¨ã—ã¦ãã¾ã—ãŸãŒã€ã‚„ã¯ã‚Šç”»åƒã‚’è¦‹ãŸã„ãŸã‚ã ã‘ã«Finderã‚’ç«‹ã¡ä¸Šã’ãŸã‚Šã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã€çµ‚äº†ã™ã‚‹ã®ã¯é¢å€’ã§ã™ã€‚

ãã“ã§ã€ã“ã‚Œã‚‰ã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

::: message
å‚è€ƒã¾ã§ã«ã€ç­†è€…ã®ç’°å¢ƒã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
```bash
â”‚ neofetch
                    'c.          ryoppippi@ryoppippi.local
                 ,xNMM.          -------------------------
               .OMMMMo           OS: macOS 14.4.1 23E224 arm64
               OMMM0,            Host: Mac15,6
     .;loddo:' loolloddol;.      Kernel: 23.4.0
   cKMMMMMMMMMMNWMMMMMMMMMM0:    Uptime: 7 days, 2 hours, 15 mins
 .KMMMMMMMMMMMMMMMMMMMMMMMWd.    Packages: 1 (brew)
 XMMMMMMMMMMMMMMMMMMMMMMMX.      Shell: fish 3.7.1
;MMMMMMMMMMMMMMMMMMMMMMMM:       Resolution: 2560x1080, 1512x982, 1080x1920
:MMMMMMMMMMMMMMMMMMMMMMMM:       DE: Aqua
.MMMMMMMMMMMMMMMMMMMMMMMMX.      WM: Rectangle
 kMMMMMMMMMMMMMMMMMMMMMMMMWd.    Terminal: WezTerm
 .XMMMMMMMMMMMMMMMMMMMMMMMMMMk   CPU: Apple M3 Pro
  .XMMMMMMMMMMMMMMMMMMMMMMMMK.   GPU: Apple M3 Pro
    kMMMMMMMMMMMMMMMMMMMMMMd     Memory: 5014MiB / 36864MiB
     ;KMMMMMMMWXXWMMMMMMMk.
       .cooc,.    .,coo:.

```


:::

æœ¬è¨˜äº‹ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ©ã¨ã—ã¦`oil.nvim`ã‚’ä½¿ã£ãŸä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ãŒã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ©ã§ã‚‚åŒæ§˜ã®ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚
https://github.com/stevearc/oil.nvim

ã¾ãŸã€è¨­å®šã¯luaã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

# Step 1: Quicklookã‚’ä½¿ã†

macOS ã«ã¯æ¨™æº–ã§Quicklookã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
ã¿ãªã•ã‚“ã€ä¸€åº¦ã¯ãŠä¸–è©±ã«ãªã£ãŸã“ã¨ã®ã‚ã‚‹ã€Finderã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‚ã‚Œã§ã™ã€‚

å®Ÿã¯ã€Terminalã‹ã‚‰ã‚‚Quicklookã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
```sh
qlmanage -p hoge.png
```

ã¤ã¾ã‚Šã€ã“ã‚Œã‚’Vim(Neovim)ã‹ã‚‰å‘¼ã³å‡ºã›ã°ã€ç”»åƒã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã¯ãšã§ã™ã€‚

https://github.com/ryoppippi/dotfiles/blob/359609ea44ddbc7b4b621aaea4ea5d4a9a06e88e/nvim/lua/core/utils.lua#L52-L55
https://github.com/ryoppippi/dotfiles/blob/359609ea44ddbc7b4b621aaea4ea5d4a9a06e88e/nvim/lua/plugin/oil/actions.lua#L24-L31
https://github.com/ryoppippi/dotfiles/blob/359609ea44ddbc7b4b621aaea4ea5d4a9a06e88e/nvim/lua/plugin/oil/init.lua#L41

ã“ã‚Œã§ã€oil.nvimã§ç”»åƒã‚’é¸æŠã—ã€Quicklookã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã­ã€‚

![0.gif](/images/5b5f704de07673/0.gif)
*oil.nvimã§ç”»åƒã‚’é¸æŠã—ã€Quicklookã‚’å‘¼ã³å‡ºã™*

# Step 2: Weztermã‚’åˆ†å‰²&ç”»åƒè¡¨ç¤º

ã•ã¦ã€Quicklookã®æ–¹æ³•ã«ã‚‚ã¾ã æ”¹å–„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

- ã„ã¡ã„ã¡Escã‚­ãƒ¼ã‚’æŠ¼ã—ã¦Quicklookã‚’é–‰ã˜ã‚‹ã®ã¯é¢å€’
- Quicklookã«FocusãŒå½“ãŸã£ã¦ã—ã¾ã†ã®ã§ã€ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ããªã„

ã¨ã„ã†ã‚ã‘ã§ã€æœ¬å‘½æŠã¯Terminalä¸Šã§ç”»åƒã‚’è¡¨ç¤ºã—ãŸã„ã‚ã‘ã§ã™ã€‚

ã“ã‚Œã¾ã§ã€Vim/Neovimã§ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹è©¦ã¿ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã—ãŸã€‚

https://github.com/kjuq/sixelview.nvim/
https://zenn.dev/vim_jp/articles/358848a5144b63

ã—ã‹ã—ã€å…ˆã®è¨˜äº‹ã«ã‚‚è§¦ã‚Œã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ã„ãã¤ã‹èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚
- ç”»åƒã®ã‚µã‚¤ã‚ºã‚’ã„ã„æ„Ÿã˜ã«èª¿æ•´ã™ã‚‹ã®ãŒé›£ã—ã„ã€‚
- gifã‚’ãƒãƒ³ã¨æ¸¡ã—ã¦ã‚‚å†ç”Ÿã•ã‚Œãªã„ã€‚

ãã®ãŸã‚ã€ä»Šå›ã¯Terminalã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

è‡ªåˆ†ã®ä½¿ç”¨ã—ã¦ã„ã‚‹Weztermã«ã¯ã€ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚
https://wezfurlong.org/wezterm/imgcat.html
https://wezfurlong.org/wezterm/cli/imgcat.html

ã“ã‚Œã«ã‚ˆã‚Šã€ä»»æ„ã®ç”»åƒã‚’Terminalä¸Šã§è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸWeztermã«ã¯ `wezterm cli`ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Šã€Weztermã®å‹•ä½œã‚’ã‚³ãƒãƒ³ãƒ‰ã§åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://wezfurlong.org/wezterm/cli/cli/index.html

ã“ã‚Œã‚‰ã‚’ãƒ•ãƒ«æ´»ç”¨ã—ã¦ã€æ¬¡ã®ã‚ˆã†ãªè¨­å®šã‚’è¡Œã„ã¾ã—ãŸã€‚

ï¼ˆä»¥ä¸‹ã€ã“ã®æ©Ÿèƒ½ã®ã“ã¨ã‚’Wezterm Previewã¨å‘¼ã³ã¾ã™ï¼‰

## oil.nvimã§`gp`ã‚’æŠ¼ã™ã¨Wezterm Previewã‚’èµ·å‹•
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/init.lua#L40

## ç¾åœ¨ã®NeovimãŒé–‹ã‹ã‚Œã¦ã„ã‚‹Pane IDã‚’å–å¾—
ç¾åœ¨ã®Pane IDã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ç’°å¢ƒå¤‰æ•° `WEZTERM_PANE` ã‚’ä½¿ã„ã¾ã™ã€‚

https://wezfurlong.org/wezterm/cli/cli/spawn.html#synopsis
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L34-L41

## Weztermã®ç”»é¢ã‚’åˆ†å‰²ã—ã¦ã€åˆ†å‰²ã•ã‚ŒãŸpaneã®idã‚’å–å¾—

Weztermã§ç”»é¢ã‚’åˆ†å‰²ã™ã‚‹ã«ã¯ã€`wezterm cli split-pane`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã«ã¯ã€åˆ†å‰²ã•ã‚ŒãŸpaneã®idãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
https://wezfurlong.org/wezterm/cli/cli/split-pane.html
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L48-L66
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L140

ã‚‚ã—ã™ã§ã«paneãŒåˆ†å‰²ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®paneã®idã‚’å–å¾—ã—ã¾ã™ã€‚
ã“ã®æ™‚ã¯ `wezterm cli list --format=json` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚

https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L91-L117

## NeovimãŒé–‹ã‹ã‚Œã¦ã„ã‚‹Paneã«Focusã‚’æˆ»ã™
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L43-L45
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L153

## oil.nvimã§ã‚«ãƒ¼ã‚½ãƒ«ãŒå‹•ããŸã³ã«ã€Wezterm Previewã‚’æ›´æ–°
ã¾ãšã€ã‚«ãƒ¼ã‚½ãƒ«ãŒé¸æŠã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L148-L151

ãã—ã¦ãã®æƒ…å ±ã‚’å…ƒã«ã€ã‚‚ã—æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Œã°ã€Weztermã®Previewç”¨ã®Paneã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã£ã¦å®Ÿè¡Œã—ã¾ã™ã€‚
ã“ã®æ™‚
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã‚ã‚Œã°ã€`ls`ã‚³ãƒãƒ³ãƒ‰
- ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Œã°ã€`wezterm imgcat`ã‚³ãƒãƒ³ãƒ‰
- ãã®ã»ã‹ã¯`bat`ã‚³ãƒãƒ³ãƒ‰

ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L151-L183

Weztermã§paneã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚‹ã«ã¯ã€ `wezterm cli send-text` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚
https://wezfurlong.org/wezterm/cli/cli/send-text.html
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L77-L89


## oil.nvimãŒçµ‚äº†ã—ãŸã‚‰ã€Wezterm Previewã‚’é–‰ã˜ã‚‹
oil.nvimã®ç¾åœ¨ã®ãƒãƒƒãƒ•ã‚¡ãŒé–‰ã˜ã‚‰ã‚ŒãŸã‚‰ã€Weztermã®Previewç”¨ã®Paneã‚‚é–‰ã˜ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://wezfurlong.org/wezterm/cli/cli/kill-pane.html
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L201-L211
https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua#L68-L75

## ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒ
:::details  å…¨ä½“åƒ
 https://github.com/ryoppippi/dotfiles/blob/6c587dfbc3773a5adfff661f0943e0edf9288a7f/nvim/lua/plugin/oil/actions.lua
:::

å‹•ä½œã¯[å†’é ­ã®GIF](#tldr)ã‚’ã”è¦§ãã ã•ã„ã€‚

# ã¾ã¨ã‚

ä»Šå›ã¯ã€oil.nvimã¨Weztermã‚’ä½¿ã£ã¦ã€Terminalä¸Šã§ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚
ã¾ã ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦å…¬é–‹ã—ã¦ãªã„ã®ã§ã™ãŒã€è¦æœ›ãŒã‚ã‚Œã°å…¬é–‹ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ä»Šå›ã¯Weztermã®æ©Ÿèƒ½ã‚’ãƒ•ãƒ«æ´»ç”¨ã—ã¾ã—ãŸãŒã€ä»–ã®Terminal Emulatorã§ã‚‚åŒæ§˜ã®ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚
ãœã²ã¿ãªã•ã‚“ã‚‚ã€è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ã¿ã¦ãã ã•ã„ã€‚
