---
title: "Event Types in Svelte and TypeScript"
emoji: "ğŸ«"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['svelte', 'typescript']
published: true
---

::: message
ã“ã®è¨˜äº‹ã¯[Event Types in React and TypeScript]( https://www.totaltypescript.com/event-types-in-react-and-typescript )ã®Svelteç‰ˆã§ã™ã€‚
è‹±èªç‰ˆã¯æ°—ãŒå‘ã„ãŸã‚‰æ›¸ãã¾ã™ã€‚
:::

::: message
ã“ã®è¨˜äº‹ã§ã¯Svelte 4.2.0ä»¥ä¸Šã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚
:::

::: message alert
ã“ã®è¨˜äº‹ã§ã¯HTML DOMã®å‹ã«ã¤ã„ã¦ã®ã¿è§¦ã‚Œã¾ã™ã€‚
Svelte Componentã®å‹ã®æ‰±ã„ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://svelte.dev/docs/svelte#types-componentevents
:::

# The Problem

Svelteã§TypeScriptã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã€ã—ã°ã—ã°ã“ã®ç¨®ã®ã‚¨ãƒ©ãƒ¼ã«é­é‡ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

```html
<script lang="ts">
    // @errors: 7006
    const onChange = (e) => {};
</script>

<input on:change={onChange} />
```

`onChange`é–¢æ•°ã®å¼•æ•°ã§ã‚ã‚‹`e`ã«ã©ã®ã‚ˆã†ãªå‹ã‚’ä¸ãˆã‚‹ã¹ãã‹ã¯å¿…ãšã—ã‚‚æ˜ç¢ºã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
DOMã”ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆã«ã¯ç•°ãªã‚‹å‹ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚

å¹¸ã„ã€ã„ãã¤ã‹è§£æ±ºç­–ãŒã‚ã‚Šã¾ã™ã€‚

# Solution 1: ä»®ã®é–¢æ•°ã‚’æ¸¡ã—ã€ãƒ›ãƒãƒ¼ã—ã¦å‹ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹

æœ€åˆã®è§£æ±ºç­–ã¯ã€`on:change`ã«ä»®ã®é–¢æ•°ã‚’æ¸¡ã—ã¦ã€ãã®é–¢æ•°ã®å¼•æ•°ã®å‹ã‚’ãƒ›ãƒãƒ¼ã—ã¦ã‚³ãƒ”ãƒ¼ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

![on:change hover](/images/380a0e4953bcaa/0.png)

ä½•ã‚„ã‚‰è¤‡é›‘ãªå‹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦`onChange`é–¢æ•°ã®å‹ã¨ã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```html
<script lang="ts">
  const onChange = (e: Event & {
    currentTarget: EventTarget & HTMLInputElement;
  }) => {};
</script>

<input on:change={onChange} />
```

# Solution 2: `SvelteHTMLElements`ã‹ã‚‰å‹ã‚’å–å¾—ã™ã‚‹

https://svelte.jp/docs/typescript#enhancing-built-in-dom-types

https://github.com/sveltejs/svelte/blob/5a8c1d2cafe8217aa1a6408b024571d3d655a431/packages/svelte/elements.d.ts

ã“ã¡ã‚‰ã«HTML DOMã®å‹ã«é–¢ã™ã‚‹è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Œã°ã€`SvelteHTMLElements`ã‹ã‚‰DOMã®å±æ€§ã®ç¨®é¡ã¨ãã‚Œãã‚Œã®å±æ€§ãŒå–ã‚‹ã¹ãé–¢æ•°ã®å‹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```html
<script lang="ts">
  import type { SvelteHTMLElements  } from 'svelte/elements';

  type InputOnChangeEvent = SvelteHTMLElements['input']['on:change']
  const onChange: NonNullable<InputOnChangeEvent> = (e) => {} 
</script>

<input on:change={onChange} />
```

ã“ã‚Œã«ã‚ˆã‚Šã€`onChange`ã®å¼•æ•°`e`ã®å‹ã‚’æ±ºå®šã§ãã¾ã™ã€‚

# Solution 3: Type Helperã‚’å®šç¾©ã—ã¦å¼•æ•°ã®å‹ã‚’å–å¾—ã™ã‚‹

Solution 2ã®ã‚„ã‚Šæ–¹ã¯ã†ã¾ãè¡Œãã®ã§ã™ãŒã€æ¯å›`SvelteHTMLElements`ã‹ã‚‰å‹æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã®ã¯é¢å€’ã§ã™ã€‚
ãã®ãŸã‚ã€Type Helperã‚’å®šç¾©ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚

```ts
import type { SvelteHTMLElements, EventHandler } from 'svelte/elements';

type Nullish<T> = T | null | undefined;

type GetEventHandlers<T extends keyof SvelteHTMLElements> = Extract<
	keyof SvelteHTMLElements[T],
	`on:${string}`
>;

export type SvelteHTMLElementEvent<
	TElement extends keyof SvelteHTMLElements,
	THandler extends GetEventHandlers<TElement>
> = SvelteHTMLElements[TElement][THandler] extends Nullish<EventHandler<infer TEvent, infer _>>
	? TEvent
	: never;
```

ã“ã®Type Helperã‚’ç”¨ã„ã‚‹ã¨ã€`onChange`ã®å¼•æ•°`e`ã«ä¸ãˆã‚‹ã¹ãå‹ã‚’ç°¡å˜ã«å–å¾—ã§ãã¾ã™ã€‚

```html
<script lang="ts">
  import type { SvelteHTMLElementEvent } from 'svelte-html-event';

  const onChange = (e: SvelteHTMLElementEvent<'input', 'on:change'>) => {}
</script>

<input on:change={onChange} />
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ã—ã¦npmã«å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€
```sh
bun install svelte-html-event
```
ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

https://github.com/ryoppippi/svelte-html-event

::: message
ã¡ãªã¿ã«ã€Svelteã®HTMLã«ã¯ç‹¬è‡ªã®å±æ€§ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ä¸Šè¨˜ã®æ–¹æ³•ã¯ç‹¬è‡ªã®å±æ€§ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

https://svelte.dev/docs/typescript#enhancing-built-in-dom-types
https://leaysgur.github.io/posts/2023/10/13/154305/
:::

# ã¾ã¨ã‚
ã™ã§ã«è‡ªåˆ†ã®é–¢ã‚ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯Solution 3ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
çš†ã•ã‚“ã‚‚æ˜¯éãŠè©¦ã—ãã ã•ã„ã€œ
