---
title: "Typia ã§ OpenAI Structured Outputã‚’ä½¿ã£ã¦ã¿ãŸï¼"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["openai", "typescript", "typia"]
published: true
---

![0.png](/images/b0d3e17322099b/0.png)

# ã¯ã˜ã‚ã«

å…ˆæ—¥ã€OpenAI ã« Structured Output ãŒç™»å ´ã—ã¾ã—ãŸã€‚

https://openai.com/index/introducing-structured-outputs-in-the-api/
https://platform.openai.com/docs/guides/structured-outputs

Structured Output ã¨ã¯ã€ä»¥å‰ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ãŸ JSON Mode ã®ä¸Šä½äº’æ›ã§ã™ã€‚
Strucuted Output ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã™ã‚‹ JSON Schema ã«å¾“ã£ã¦ã€OpenAI ãŒç”Ÿæˆã—ãŸ JSON ã‚’è¿”ã—ã¦ãã‚Œã¾ã™(ãã®ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™)ã€‚
ãã®ãŸã‚ã€å¾“æ¥ã® JSON Mode ã‚ˆã‚Šä¿¡é ¼æ€§ã®é«˜ã„çµæœã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

## OpenAI ã¯ Zod ã«å¯¾å¿œ

OpenAI ã®å…¬å¼ã® SDK ã§ã¯ `zod helper` ãªã‚‹ã‚‚ã®ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ã€zod schema ã‚’æ¸¡ã™ã¨ã€å†…éƒ¨ã§ JSON Schema ã¸ã®å¤‰æ›ã‚’è¡Œã„ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€response ã® validation ã¾ã§ã‚‚è¡Œã£ã¦ãã‚Œã‚‹ä¾¿åˆ©ãªã‚‚ã®ã§ã™ã€‚

https://github.com/openai/openai-node/blob/31e4afd6ca50e8e2560598296c099390c5956e31/src/helpers/zod.ts

ã¨ã¯ã„ãˆã€å®Ÿè£…ã¯ãã‚“ãªã«é›£ã—ã„ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã“ã§ã€ä»Šå›ã¯ Typia ã§ OpenAI Structured Output ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚
 
# `Typia` ã¨ã¯

ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ï¼
https://zenn.dev/ryoppippi/articles/c4775a3a5f3c11

# `Typia` ã§ OpenAI Structured Output ã‚’ä½¿ã†

ä»Šå›ã€`zod helper` ã¨åŒã˜ã‚ˆã†ãªé–¢æ•°ã‚’å®Ÿè£…ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

https://github.com/ryoppippi/typiautil

ç¾åœ¨ã®ã¨ã“ã‚ã€ `zodResponseFormat` ã€ `zodFunction` ç›¸å½“ã®é–¢æ•°ã¯å®Ÿè£…ã—ã¦ã‚ã‚Šã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ä»¥å‰ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å½¢ã§è©¦ã—ã¦ã¿ã¾ã™ã€‚

https://zenn.dev/ryoppippi/articles/ce3631be2e2310

https://github.com/ryoppippi/openai-with-typia/blob/c2596ed7b9def86b3d56f1cec2ac5099bac282ed/src/index.ts#L27-L45

`Typia` ã¯æ¨™æº–ã§å‹æƒ…å ±ã‹ã‚‰ JSON Schema ã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
`Typia` ã¯å‹æƒ…å ±ã«ä»˜ä¸ã—ãŸ JSDoc ã‚’ `description` ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã®ã§ã€ç›´æ„Ÿçš„ã« JSON Schema ã‚’å®šç¾©ã§ãã¦è‰¯ã„ã§ã™ã­ã€‚
ã‚‚ã¡ã‚ã‚“ã€é•·ã•ã‚„è©³ç´°ãªå‹æƒ…å ±(int, string, boolean, æœ€å¤§å€¤/æœ€å°å€¤ã€ãªã©)ã‚‚ `Typia` ã® `tag` ã‚’ä½¿ã£ã¦æŒ‡å®šã§ãã¾ã™ã€‚

https://typia.io/docs/json/schema/

çµæœã¨ã—ã¦ã€ä»¥ä¸‹ã®å‹å®šç¾©ã‹ã‚‰:
https://github.com/ryoppippi/openai-with-typia/blob/c2596ed7b9def86b3d56f1cec2ac5099bac282ed/src/type.ts

ä»¥ä¸‹ã® JSON Schema ãŒç”Ÿæˆã•ã‚Œã¾ã™:
https://github.com/ryoppippi/openai-with-typia/blob/c2596ed7b9def86b3d56f1cec2ac5099bac282ed/schema.json

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã„ã„æ„Ÿã˜ã«æ§‹é€ åŒ–ã•ã‚ŒãŸ JSON ãŒè¿”ã£ã¦ãã¾ã™ã€‚

https://github.com/ryoppippi/openai-with-typia/blob/c2596ed7b9def86b3d56f1cec2ac5099bac282ed/result.json

ã„ã„æ„Ÿã˜ã§ã™ã­ï¼

:::message

æœ¬è¨˜äº‹ã¨ã¯é–¢ä¿‚ã®ãªã„ä½™è«‡ã§ã™ãŒã€ä½œè€…ãŒ OpenAI ã«ç‰¹åŒ–ã—ãŸ Schema Library ã‚’ä½œã£ã¦ã„ã¾ã™ï¼ˆå†…éƒ¨ã§ `Typia` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹)ã€‚
https://github.com/wrtnio/openai-function-schema/
:::

# ã¾ã¨ã‚

- OpenAI Structured Output ã‚’ä½¿ã£ã¦ã¿ãŸ
- `Typia` ã§ OpenAI Structured Output ã‚’ä½¿ã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆã—ãŸ
- `Typia` ã¯å‹æƒ…å ±ã‹ã‚‰ JSON Schema ã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€ç›´æ„Ÿçš„ã« JSON Schema ã‚’å®šç¾©ã§ãã¦è‰¯ã„


